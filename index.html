<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒãƒªã‚´ãƒ³ï¼†ãƒ©ã‚¤ãƒ³æç”»ã‚¢ãƒ—ãƒªğŸ’–</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #fff0f5;
            text-align: center;
            margin: 20px;
        }
        h2 {
            color: #ff69b4;
        }
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 10px;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            font-weight: bold;
            color: white;
            background: #ff69b4;
            border: none;
            border-radius: 20px;
            margin: 0 5px;
            transition: 0.3s;
        }
        .tab.active {
            background: #ff1493;
        }
        textarea {
            width: 80%;
            height: 100px;
            border: 2px solid #ff69b4;
            border-radius: 10px;
            padding: 10px;
            font-size: 14px;
            background-color: #fff;
        }
        button {
            background: linear-gradient(135deg, #ff69b4, #ff1493);
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 20px;
            cursor: pointer;
            transition: 0.3s;
        }
        button:hover {
            background: linear-gradient(135deg, #ff1493, #ff69b4);
            transform: scale(1.05);
        }
        #map {
            width: 80%;
            height: 500px;
            margin: 20px auto;
            border: 3px solid #ff69b4;
            border-radius: 10px;
        }
    </style>
</head>
<body>

    <h2>åº§æ¨™ã‚’å…¥åŠ›ã—ã¦ãƒãƒªã‚´ãƒ³ or ãƒ©ã‚¤ãƒ³ã‚’æç”»</h2>

    <div class="tabs">
        <button class="tab active" id="tab2D" onclick="switchTab('2D')">2Dï¼ˆ[lon, lat]ï¼‰</button>
        <button class="tab" id="tab3D" onclick="switchTab('3D')">3Dï¼ˆ[lon, lat, alt]ï¼‰</button>
    </div>

    <textarea id="coordsInput" placeholder="[ [lon,lat], [lon,lat], [lon,lat] ]"></textarea>
    <br><br>
    <button onclick="drawShape()">âœ¨ æç”»ã™ã‚‹ âœ¨</button>
    
    <div id="map"></div>
    <br><br>
    <div>&#xA9;OpenStreetMap<br /><a href="https://www.openstreetmap.org/copyright" target="_blank">è‘—ä½œæ¨©ã«ã¤ã„ã¦</a></div>

    <script>
        let mode = "2D"; // åˆæœŸãƒ¢ãƒ¼ãƒ‰ã¯2D
        let drawnLayer;

        // ğŸŒ åœ°å›³ã®åˆæœŸåŒ–
        const map = L.map('map').setView([35.6895, 139.6917], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        function switchTab(selectedMode) {
            mode = selectedMode;
            document.getElementById("tab2D").classList.toggle("active", mode === "2D");
            document.getElementById("tab3D").classList.toggle("active", mode === "3D");
            // ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’å¤‰æ›´
            document.getElementById("coordsInput").placeholder = mode === "2D" 
                ? "[ [lon,lat], [lon,lat], [lon,lat] ]" 
                : "[ [lon,lat,alt], [lon,lat,alt], [lon,lat,alt] ]";
            
            document.getElementById("coordsInput").value = "";
        }

        function drawShape() {
            const input = document.getElementById("coordsInput").value.trim();
            if (!input) return alert("åº§æ¨™ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼");

            try {
                let coordArray;

                // ğŸ“Œ JSONã¨ã—ã¦æ­£ã—ããƒ‘ãƒ¼ã‚¹ã™ã‚‹ï¼ˆãã®ã¾ã¾ or æ‰‹å‹•ã§é…åˆ—åŒ–ï¼‰
                if (input.startsWith("[") && input.endsWith("]")) {
                    coordArray = JSON.parse(input);
                } else {
                    return alert("âš ï¸ JSONå½¢å¼ã§å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ä¾‹: [139.7,35.6],[139.8,35.7] ");
                }

                // ğŸ“Œ ãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ãé…åˆ—ã«ãªã£ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                if (!Array.isArray(coordArray) || coordArray.length === 0) {
                    return alert("âš ï¸ åº§æ¨™ãƒ‡ãƒ¼ã‚¿ãŒç©ºã§ã™ï¼");
                }

                let coords = [];
                if (mode === "2D") {
                    if (!coordArray.every(point => Array.isArray(point) && point.length === 2 && point.every(num => typeof num === "number"))) {
                        return alert("âš ï¸ 2Dåº§æ¨™ã¯ [lon, lat] ã®ãƒšã‚¢ã§å…¥åŠ›ã—ã¦ãã ã•ã„ï¼");
                    }
                    coords = coordArray.map(point => [point[1], point[0]]); // [lon, lat] â†’ [lat, lon]
                } else { // 3Dãƒ¢ãƒ¼ãƒ‰
                    if (!coordArray.every(point => Array.isArray(point) && point.length === 3 && point.every(num => typeof num === "number"))) {
                        return alert("âš ï¸ 3Dåº§æ¨™ã¯ [lon, lat, alt] ã®ã‚»ãƒƒãƒˆã§å…¥åŠ›ã—ã¦ãã ã•ã„ï¼");
                    }
                    coords = coordArray.map(point => [point[1], point[0]]); // [lon, lat, alt] â†’ [lat, lon]
                }

                if (coords.length < 2) return alert(" 2ç‚¹ä»¥ä¸Šã®åº§æ¨™ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼");

                // ğŸ”„ æ—¢å­˜ã®å›³å½¢ã‚’å‰Šé™¤
                if (drawnLayer) map.removeLayer(drawnLayer);

                // ğŸŸ¢ ãƒãƒªã‚´ãƒ³ or ğŸ”µ ãƒ©ã‚¤ãƒ³ã‚’åˆ¤å®šã—ã¦æç”»
                if (JSON.stringify(coords[0]) === JSON.stringify(coords[coords.length - 1])) {
                    drawnLayer = L.polygon(coords, { color: "#ff1493" }).addTo(map);
                } else {
                    drawnLayer = L.polyline(coords, { color: "#007bff" }).addTo(map);
                }

                // ğŸ—ºï¸ è¡¨ç¤ºç¯„å›²ã‚’è‡ªå‹•èª¿æ•´
                map.fitBounds(drawnLayer.getBounds());

            } catch (e) {
                alert("âš ï¸ JSONå½¢å¼ãŒä¸æ­£ã§ã™ï¼ã‚¨ãƒ©ãƒ¼å†…å®¹ï¼š" + e.message);
            }
        }
    </script>

</body>
</html>
